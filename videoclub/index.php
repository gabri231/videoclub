<?php
/////////////////////////////////////////////////////////////////////////////
//  CONTROLADORES
require_once 'app/modelo/core.php';
/////////////////////////////////////////////////////////////////////////////
//		COMPROBAMOS EL LOGIN
session_start();
if( isset($_COOKIE['recordar']) ){
	if( isset($_COOKIE['datosUsuario']) ){
		$datosUsuario = unserialize($_COOKIE["datosUsuario"]);	
		$_SESSION['logged'] = $datosUsuario;
	}
}
if (isset($_SESSION['logged']['user']))
	{ $logged = true; }
else
	{ $logged = false; }
/////////////////////////////////////////////////////////////////////////////
// 	FORMATEO ENRUTADO PAGINAS
$ruta = $_SERVER['REQUEST_URI'];			// $ruta = /videoclub/index.php
$ruta = substr($ruta, strlen(PAGINA)); 		// $ruta = index.php
/////////////////////////////////////////////////////////////////////////////
// 	ENRUTAMIENTO DE PETICIONES POR URL
//  index.php  //////////////////////////////////////////////////////////////
if ($ruta == 'index.php/'){header('location: '.PAGINA.'index.php');}
if ($ruta == 'index.php' || $ruta == '/' || $ruta =="") {
	// Comprovamos si se han logeado los usuarios.
	if ($logged){
		$tituloPagina ="Bienvenido ".strtoupper($_SESSION['logged']['user']).", este es tu videoclub.";
		include('app/vista/principal_privada.php');
	}else{
		$tituloPagina ="Bienvenido, este es tu videoclub.";
		include('app/vista/principal_publica.php');
	}
}

/////////////////////////////////////////////////////////////////////////////
// index.php/login //////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////
elseif ($ruta == 'index.php/login' || $ruta == 'index.php/login/') {
	require 'app/controlador/login.php';
}

/////////////////////////////////////////////////////////////////////////////
// index.php/peliculas //////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////
elseif ($ruta == 'index.php/peliculas' || $ruta == 'index.php/peliculas/') {
	require 'app/controlador/listadoPeliculas.php';
}

/////////////////////////////////////////////////////////////////////////////
// index.php/registro ///////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////
elseif ($ruta == 'index.php/registro' || $ruta == 'index.php/registro/') {
	include('app/controlador/registro.php');
}

/////////////////////////////////////////////////////////////////////////////
// index.php/logout /////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////
elseif ($ruta == 'index.php/logout' || $ruta == 'index.php/logout/') {
    include('app/controlador/cerrar.php');
}

/////////////////////////////////////////////////////////////////////////////
// ERROR 404 ////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////
else {
    header('Status: 404 Not Found');
    $tituloPagina = "404 página no encontrada";
    include('app/vista/error404.php');
}
// 	FIN DE ENRUTAMIENTO DE PETICIONES POR URL
/////////////////////////////////////////////////////////////////////////////
echo "<br><br>".$ruta;
?>